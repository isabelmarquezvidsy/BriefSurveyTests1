<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recruitment Application Survey</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and ReactDOM CDNs -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for JSX transformation in browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        /* Custom styles for better visual alignment and consistency */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Ensure inputs and textareas respect max-width */
        input[type="text"], textarea {
            max-width: 600px;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        // React application code starts here

        // Create a context for the user data and survey configuration
        const AppContext = React.createContext();

        // Helper function to generate a random date of birth (e.g., between 1980 and 2005)
        const getRandomDate = (startYear, endYear) => {
            const year = Math.floor(Math.random() * (endYear - startYear + 1)) + startYear;
            const month = Math.floor(Math.random() * 12) + 1;
            const day = Math.floor(Math.random() * 28) + 1; // Simplistic to avoid month-day issues
            return `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        };

        // Function to generate 100 fictional users
        const generateFictionalUsers = () => {
            const users = [];
            const names = [
                "Alice", "Bob", "Charlie", "Diana", "Eve", "Frank", "Grace", "Heidi", "Ivan", "Judy",
                "Kevin", "Liam", "Mia", "Noah", "Olivia", "Peter", "Quinn", "Rachel", "Sam", "Tina",
                "Umar", "Vera", "Walter", "Xena", "Yara", "Zane", "Anna", "Ben", "Catherine", "David",
                "Emma", "Felix", "Georgia", "Harry", "Isabel", "Jack", "Karen", "Leo", "Megan", "Nathan",
                "Oscar", "Pamela", "Quentin", "Rebecca", "Steven", "Tara", "Ursula", "Victor", "Wendy", "Xavier",
                "Yvonne", "Zack", "Amber", "Brian", "Chloe", "Daniel", "Emily", "Finn", "Gabriella", "Henry",
                "Iris", "Jake", "Kim", "Louis", "Maria", "Nora", "Owen", "Penelope", "Ronan", "Sophia",
                "Thomas", "Uma", "Vincent", "Willow", "Zara", "Adam", "Bella", "Cody", "Daisy", "Ethan",
                "Faith", "Gavin", "Hannah", "Isaac", "Jasmine", "Kyle", "Lily", "Max", "Nina", "Oliver",
                "Paige", "Riley", "Sarah", "Tyler", "Violet", "Will", "Zara", "Aiden", "Brooke", "Caleb"
            ];
            const portfolios = [
                "https://www.creativeportfolio.com/user1", "https://www.artstation.com/user2",
                "https://www.behance.net/user3", "https://www.dribbble.com/user4",
                "https://www.flickr.com/user5", "https://www.instagram.com/user6",
                "https://www.unsplash.com/user7", "https://www.deviantart.com/user8",
                "https://www.vimeo.com/user9", "https://www.youtube.com/user10"
            ];

            // Corrected and expanded city-country mapping for factual accuracy
            const cityCountryMap = {
                "London": "UK",
                "New York": "USA",
                "Paris": "France",
                "Berlin": "Germany",
                "Tokyo": "Japan",
                "Sydney": "Australia",
                "Toronto": "Canada",
                "Madrid": "Spain",
                "Rome": "Italy",
                "Beijing": "China",
                "Los Angeles": "USA",
                "Manchester": "UK",
                "Lyon": "France",
                "Munich": "Germany",
                "Osaka": "Japan",
                "Melbourne": "Australia",
                "Vancouver": "Canada",
                "Barcelona": "Spain",
                "Milan": "Italy",
                "Shanghai": "China"
            };

            const cities = Object.keys(cityCountryMap);
            const genders = ["man", "woman", "non_binary", "prefer_not_to_say"];
            const languages = ["english", "french", "spanish", "german", "chinese", "japanese"];
            const origins = ["USA", "UK", "Canada", "France", "Germany", "Spain", "Japan", "China", "Australia", "Italy"];
            const ethnicities = ["White", "Black", "South_Asian", "East_and_SE_Asian", "Hispanic/Latin", "Middle_Eastern", "Pacific_Islander", "Other"];
            const hairTypes = ["wavy", "curly", "bald", "straight", "coily", "other"];
            const hairColours = ["black", "blond", "brunette", "brown", "red", "bald", "white_or_grey", "other"];
            const tattoosOptions = ["none", "yes_not_visible", "yes_visible_face_neck_shoulders"];
            const piercingsOptions = ["none", "yes_ear_piercing", "yes_not_visible", "yes_facial_piercings"];
            const coStarsOptions = ["dog", "cat", "other_pets", "baby", "kids_2_6", "kids_7_12", "teenagers", "couple", "friends", "parents"];
            const filmingLocations = ["house", "apartment", "car", "garden", "podcast_setup", "gaming_setup", "gym_fitness_studio", "in_house_laundry", "home_office_study", "countryside", "city", "beach"];

            // Funny invented address components
            const streetNumbers = ["42", "101", "7", "99", "666", "13"];
            const streetNames = ["Whispering Willow Way", "Giggle Grove", "Rainbow Road", "Starlight Street", "Dragonfly Drive", "Mystic Meadow Lane", "Unicorn Alley", "Pixel Place"];
            const streetTypes = ["Lane", "Road", "Avenue", "Street", "Boulevard", "Drive", "Place", "Circuit"];
            const fantasticalAreas = ["Cloud City", "Moonbeam Metropolis", "Enchanted Forest", "Quantum Quarters", "Singing Sands", "Lost Lagoon"];
            const zipCodes = ["90210", "50001", "ABCDE", "XY12Z"];

            for (let i = 0; i < 100; i++) {
                const randomCity = cities[Math.floor(Math.random() * cities.length)];
                const correspondingCountry = cityCountryMap[randomCity];

                // Determine number of languages based on the 50% split
                let numLanguages;
                if (i % 2 === 0) { // For roughly 50% of users (even indices)
                    numLanguages = Math.floor(Math.random() * 2) + 2; // 2 or 3 languages
                } else { // For the other 50% (odd indices)
                    numLanguages = Math.floor(Math.random() * 3) + 1; // 1, 2, or 3 languages
                }

                // Ensure unique languages are selected
                const selectedLanguages = new Set();
                while (selectedLanguages.size < numLanguages) {
                    selectedLanguages.add(languages[Math.floor(Math.random() * languages.length)]);
                }

                // Ensure at least 3 filming locations
                const userFilmingLocations = new Set();
                while (userFilmingLocations.size < 3 || (userFilmingLocations.size < filmingLocations.length && Math.random() < 0.5)) { // At least 3, and potentially more
                    userFilmingLocations.add(filmingLocations[Math.floor(Math.random() * filmingLocations.length)]);
                }

                // Ensure at least 3 co-stars
                const userCoStars = new Set();
                while (userCoStars.size < 3 || (userCoStars.size < coStarsOptions.length && Math.random() < 0.5)) { // At least 3, and potentially more
                    userCoStars.add(coStarsOptions[Math.floor(Math.random() * coStarsOptions.length)]);
                }


                const user = {
                    id: `user-${i + 1}`, // Add a simple ID
                    name: names[i % names.length] + ' ' + (i + 1), // Make names unique
                    portfolio: portfolios[Math.floor(Math.random() * portfolios.length)],
                    primary_work_location: [
                        randomCity,
                        correspondingCountry
                    ],
                    date_of_birth: getRandomDate(1980, 2005),
                    gender: genders[Math.floor(Math.random() * genders.length)],
                    languages_spoken_fluently: Array.from(selectedLanguages), // Use the unique selected languages
                    country_of_origin: origins[Math.floor(Math.random() * origins.length)],
                    ethnicity: ethnicities[Math.floor(Math.random() * ethnicities.length)],
                    co_stars: Array.from(userCoStars), // Assign generated co-stars
                    filming_location: Array.from(userFilmingLocations), // Assign generated filming locations
                };

                // Conditionally available fields (70% probability)
                if (Math.random() < 0.7) {
                    // Generate a funny invented address
                    const num = streetNumbers[Math.floor(Math.random() * streetNumbers.length)];
                    const street = streetNames[Math.floor(Math.random() * streetNames.length)];
                    const type = streetTypes[Math.floor(Math.random() * streetTypes.length)];
                    const area = fantasticalAreas[Math.floor(Math.random() * fantasticalAreas.length)];
                    const zip = zipCodes[Math.floor(Math.random() * zipCodes.length)];
                    user.Address = `${num} ${street} ${type}, ${area}, ${randomCity} ${zip}`; // Using city for consistency
                }
                if (Math.random() < 0.7) user.Mobile = `+1-${Math.floor(1000000000 + Math.random()*9000000000)}`;
                if (Math.random() < 0.7) user.hair_type = hairTypes[Math.floor(Math.random() * hairTypes.length)];
                if (Math.random() < 0.7) user.hair_colour = hairColours[Math.floor(Math.random() * hairColours.length)];
                if (Math.random() < 0.7) user.tattoos = tattoosOptions[Math.floor(Math.random() * tattoosOptions.length)];
                if (Math.random() < 0.7) user.piercings = piercingsOptions[Math.floor(Math.random() * piercingsOptions.length)];

                users.push(user);
            }
            return users;
        };

        // Backstage Component
        const Backstage = ({ setView }) => {
            const { surveyConfig, setSurveyConfig } = React.useContext(AppContext);
            const [projectTitle, setProjectTitle] = React.useState(surveyConfig.projectTitle);
            const [projectCode, setProjectCode] = React.useState(surveyConfig.projectCode);
            const [briefSummary, setBriefSummary] = React.useState(surveyConfig.briefSummary || ''); // New state for brief summary
            // selectedQuestions now stores objects { id: string, note: string, details: any }
            const [selectedQuestions, setSelectedQuestions] = React.useState(surveyConfig.selectedQuestions);
            const [message, setMessage] = React.useState('');

            const allFilmingLocations = ["house", "apartment", "car", "garden", "podcast_setup", "gaming_setup", "gym_fitness_studio", "in_house_laundry", "home_office_study", "countryside", "city", "beach"];
            const allCoStars = ["dog", "cat", "other_pets", "baby", "kids_2_6", "kids_7_12", "teenagers", "couple", "friends", "parents", "none_of_the_above"];


            // Update local state when surveyConfig from context changes
            React.useEffect(() => {
                setProjectTitle(surveyConfig.projectTitle);
                setProjectCode(surveyConfig.projectCode);
                setBriefSummary(surveyConfig.briefSummary || ''); // Update brief summary from context
                setSelectedQuestions(surveyConfig.selectedQuestions);
            }, [surveyConfig]);


            const handleSaveSurvey = () => {
                const newConfig = {
                    projectTitle,
                    projectCode,
                    briefSummary, // Include brief summary in saved config
                    selectedQuestions
                };
                setSurveyConfig(newConfig); // Update context
                setMessage('Survey configuration saved for this session!');
                // No persistence without Firebase
            };

            const handleQuestionChange = (e) => {
                const { value, checked } = e.target;
                // Find the question in the current state by its ID
                const existingQuestion = selectedQuestions.find(q => q.id === value);

                if (checked) {
                    // If checked and not already present, add it with an empty note and empty details
                    if (!existingQuestion) {
                        setSelectedQuestions(prev => [...prev, { id: value, note: '', details: [] }]);
                    }
                } else {
                    // If unchecked, remove it
                    setSelectedQuestions(prev => prev.filter(q => q.id !== value));
                }
            };

            const handleNoteChange = (id, note) => {
                setSelectedQuestions(prev =>
                    prev.map(q => (q.id === id ? { ...q, note } : q))
                );
            };

            const handleFilmingLocationChipChange = (location) => {
                setSelectedQuestions(prev =>
                    prev.map(q => {
                        if (q.id === 'filmingLocation') {
                            const currentDetails = q.details || [];
                            const locationExists = currentDetails.some(detail => detail.name === location);

                            let updatedDetails;
                            if (locationExists) {
                                updatedDetails = currentDetails.filter(detail => detail.name !== location);
                            } else {
                                updatedDetails = [
                                    ...currentDetails,
                                    { name: location, askConfirmAccess: false, confirmAccessNote: '', askForPhoto: false, photoNote: '' }
                                ];
                            }
                            return { ...q, details: updatedDetails };
                        }
                        return q;
                    })
                );
            };

            const handleFilmingLocationSubQuestionChange = (locationName, subQuestionType, checked) => {
                setSelectedQuestions(prev =>
                    prev.map(q => {
                        if (q.id === 'filmingLocation') {
                            const updatedDetails = (q.details || []).map(detail => {
                                if (detail.name === locationName) {
                                    return { ...detail, [subQuestionType]: checked };
                                }
                                return detail;
                            });
                            return { ...q, details: updatedDetails };
                        }
                        return q;
                    })
                );
            };

            const handleFilmingLocationSubNoteChange = (locationName, subNoteType, noteValue) => {
                setSelectedQuestions(prev =>
                    prev.map(q => {
                        if (q.id === 'filmingLocation') {
                            const updatedDetails = (q.details || []).map(detail => {
                                if (detail.name === locationName) {
                                    return { ...detail, [subNoteType]: noteValue };
                                }
                                return detail;
                            });
                            return { ...q, details: updatedDetails };
                        }
                        return q;
                    })
                );
            };

            const handleCoStarChipChange = (coStar) => {
                setSelectedQuestions(prev =>
                    prev.map(q => {
                        if (q.id === 'coStars') {
                            const currentDetails = q.details || [];
                            const coStarExists = currentDetails.some(detail => detail.name === coStar);

                            let updatedDetails;
                            if (coStarExists) {
                                updatedDetails = currentDetails.filter(detail => detail.name !== coStar);
                            } else {
                                updatedDetails = [
                                    ...currentDetails,
                                    { name: coStar, askConfirmAvailability: false, confirmAvailabilityNote: '', askForCastingPhoto: false, castingPhotoNote: '' }
                                ];
                            }
                            return { ...q, details: updatedDetails };
                        }
                        return q;
                    })
                );
            };

            const handleCoStarSubQuestionChange = (coStarName, subQuestionType, checked) => {
                setSelectedQuestions(prev =>
                    prev.map(q => {
                        if (q.id === 'coStars') {
                            const updatedDetails = (q.details || []).map(detail => {
                                if (detail.name === coStarName) {
                                    return { ...detail, [subQuestionType]: checked };
                                }
                                return detail;
                            });
                            return { ...q, details: updatedDetails };
                        }
                        return q;
                    })
                );
            };

            const handleCoStarSubNoteChange = (coStarName, subNoteType, noteValue) => {
                setSelectedQuestions(prev =>
                    prev.map(q => {
                        if (q.id === 'coStars') {
                            const updatedDetails = (q.details || []).map(detail => {
                                if (detail.name === coStarName) {
                                    return { ...detail, [subNoteType]: noteValue };
                                }
                                return detail;
                            });
                            return { ...q, details: updatedDetails };
                        }
                        return q;
                    })
                );
            };


            const isQuestionSelected = (id) => selectedQuestions.some(q => q.id === id);
            const getQuestionNote = (id) => selectedQuestions.find(q => q.id === id)?.note || '';
            const getFilmingLocationDetails = () => selectedQuestions.find(q => q.id === 'filmingLocation')?.details || [];
            const getCoStarDetails = () => selectedQuestions.find(q => q.id === 'coStars')?.details || [];


            return (
                <div className="min-h-screen bg-gray-100 flex justify-center py-10 px-4">
                    <div className="bg-white p-8 rounded-lg shadow-xl w-full max-w-[800px]">
                        <div className="flex justify-between items-center mb-10">
                            <h1 className="text-3xl font-extrabold text-gray-800">Internal/Community UX</h1>
                            <button
                                onClick={() => setView('frontstage')}
                                className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition duration-300 ease-in-out shadow-md"
                            >
                                View Creator UX (Answer Questions)
                            </button>
                        </div>

                        <br /><br /><br />

                        <div className="mb-6">
                            <label htmlFor="projectTitle" className="block text-gray-700 text-base font-medium mb-1">Project Title</label>
                            <input
                                type="text"
                                id="projectTitle"
                                value={projectTitle}
                                onChange={(e) => setProjectTitle(e.target.value)}
                                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 max-w-[600px]"
                                placeholder=""
                            />
                        </div>

                        <div className="mb-6">
                            <label htmlFor="projectCode" className="block text-gray-700 text-base font-medium mb-1">Project Code</label>
                            <input
                                type="text"
                                id="projectCode"
                                value={projectCode}
                                onChange={(e) => setProjectCode(e.target.value)}
                                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 max-w-[600px]"
                                placeholder=""
                            />
                        </div>

                        {/* New "Brief requirement summary" field */}
                        <div className="mb-10">
                            <label htmlFor="briefSummary" className="block text-gray-700 text-base font-medium mb-1">Brief requirement summary</label>
                            <textarea
                                id="briefSummary"
                                value={briefSummary}
                                onChange={(e) => setBriefSummary(e.target.value)}
                                className="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-400 resize-y min-h-[70px] max-w-[600px]"
                                rows="3"
                                placeholder="ðŸ‡ºðŸ‡¸ New York-based.&#10;âœ¨ Age 25+, any gender.&#10;ðŸ‘€ No visible tattoos (OK if can be covered)."
                            ></textarea>
                        </div>

                        <div className="mb-8">
                            <h2 className="text-xl font-semibold text-gray-800 mb-4">Standard Profile Questions</h2>
                            <p className="text-gray-600 text-sm mb-6">
                                Select the questions you'd like to include in this brief application survey.
                                We'll only ask the candidate if we don't have the answer yet, or if you ask them to check/update it.
                            </p>
                            <div className="space-y-8">

                                {/* Portfolio Question */}
                                <div className="border border-gray-200 rounded-md p-4 bg-gray-50">
                                    <label className="flex items-center text-gray-700 cursor-pointer mb-2">
                                        <input
                                            type="checkbox"
                                            value="portfolio"
                                            checked={isQuestionSelected('portfolio')}
                                            onChange={handleQuestionChange}
                                            className="form-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500"
                                        />
                                        <span className="ml-3 text-lg font-medium">Portfolio</span>
                                    </label>
                                    <p className="text-gray-500 text-sm ml-8 mb-3">
                                        They've already shared a portfolio with us. Use this if you'd like them to confirm it's still the right one for this role.
                                    </p>
                                    <label htmlFor="portfolio-note" className="block text-gray-600 text-xs font-semibold ml-8 mb-1">Add a note (optional)</label>
                                    <textarea
                                        id="portfolio-note"
                                        value={getQuestionNote('portfolio')}
                                        onChange={(e) => handleNoteChange('portfolio', e.target.value)}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-400 ml-8 resize-y min-h-[70px] max-w-[600px]"
                                        rows="3"
                                        placeholder="ðŸŽ¥ Bonus if you have existing footage of yourself at festivals, gigs, or similar"
                                    ></textarea>
                                </div>

                                {/* Primary Work Location Question */}
                                <br /><br />
                                <div className="border border-gray-200 rounded-md p-4 bg-gray-50">
                                    <label className="flex items-center text-gray-700 cursor-pointer mb-2">
                                        <input
                                            type="checkbox"
                                            value="primaryWorkLocation"
                                            checked={isQuestionSelected('primaryWorkLocation')}
                                            onChange={handleQuestionChange}
                                            className="form-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500"
                                        />
                                        <span className="ml-3 text-lg font-medium">Primary Work Location</span>
                                    </label>
                                    <p className="text-gray-500 text-sm ml-8 mb-3">
                                        They've already told us where they work from. Use this to ask them to confirm they are in the country required for this shoot.
                                    </p>
                                    <label htmlFor="location-note" className="block text-gray-600 text-xs font-semibold ml-8 mb-1">Add a note (optional)</label>
                                    <textarea
                                        id="location-note"
                                        value={getQuestionNote('primaryWorkLocation')}
                                        onChange={(e) => handleNoteChange('primaryWorkLocation', e.target.value)}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-400 ml-8 resize-y min-h-[70px] max-w-[600px]"
                                        rows="3"
                                        placeholder="e.g., This shoot is in London. Are you available to work there during the brief?"
                                    ></textarea>
                                </div>
                                {/* Address Question */}
                                <br /><br />
                                <div className="border border-gray-200 rounded-md p-4 bg-gray-50">
                                    <label className="flex items-center text-gray-700 cursor-pointer mb-2">
                                        <input
                                            type="checkbox"
                                            value="address"
                                            checked={isQuestionSelected('address')}
                                            onChange={handleQuestionChange}
                                            className="form-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500"
                                        />
                                        <span className="ml-3 text-lg font-medium">Address</span>
                                    </label>
                                    <p className="text-gray-500 text-sm ml-8 mb-3">
                                        We'll only ask this if we don't already have the candidate's address, or if you want them to check it's still up to date.
                                    </p>
                                    <label htmlFor="address-note" className="block text-gray-600 text-xs font-semibold ml-8 mb-1">Add a note (optional)</label>
                                    <textarea
                                        id="address-note"
                                        value={getQuestionNote('address')}
                                        onChange={(e) => handleNoteChange('address', e.target.value)}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-400 ml-8 resize-y min-h-[70px] max-w-[600px]"
                                        rows="3"
                                        placeholder="We'll be sending you products! Please share your preferred shipping address."
                                    ></textarea>
                                </div>

                                {/* Filming Location Question */}
                                <br /><br />
                                <div className="border border-gray-200 rounded-md p-4 bg-gray-50">
                                    <label className="flex items-center text-gray-700 cursor-pointer mb-2">
                                        <input
                                            type="checkbox"
                                            value="filmingLocation"
                                            checked={isQuestionSelected('filmingLocation')}
                                            onChange={handleQuestionChange}
                                            className="form-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500"
                                        />
                                        <span className="ml-3 text-lg font-medium">Filming location needed for this brief</span>
                                    </label>
                                    <p className="text-gray-500 text-sm ml-8 mb-3">
                                        Select locations needed for this brief. We'll only ask the creator if they haven't already shared this info with us, or if you request confirmation.
                                    </p>
                                    <div className="ml-8 mt-4 flex flex-wrap gap-2">
                                        {allFilmingLocations.map(location => {
                                            const locationDetail = getFilmingLocationDetails().find(d => d.name === location);
                                            const isLocationSelected = !!locationDetail;

                                            return (
                                                <React.Fragment key={location}>
                                                    <button
                                                        type="button"
                                                        onClick={() => handleFilmingLocationChipChange(location)}
                                                        className={`px-4 py-2 rounded-full text-sm font-medium transition-colors duration-200
                                                            ${isLocationSelected
                                                                ? 'bg-blue-600 text-white shadow-md'
                                                                : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                            }`}
                                                    >
                                                        {location.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}
                                                    </button>

                                                    {isLocationSelected && (
                                                        <div className="w-full ml-8 mt-4 p-3 border border-gray-200 rounded-md bg-white shadow-sm">
                                                            <h4 className="text-md font-semibold text-gray-700 mb-3">{location.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())} Details:</h4>

                                                            {/* Ask to confirm access */}
                                                            <label className="flex items-center text-gray-700 cursor-pointer mb-2">
                                                                <input
                                                                    type="checkbox"
                                                                    checked={locationDetail.askConfirmAccess}
                                                                    onChange={(e) => handleFilmingLocationSubQuestionChange(location, 'askConfirmAccess', e.target.checked)}
                                                                    className="form-checkbox h-4 w-4 text-blue-600 rounded"
                                                                />
                                                                <span className="ml-2">Ask to confirm access</span>
                                                            </label>
                                                            {/* Removed the note field here */}
                                                            {/* Ask for a photo of the space */}
                                                            <label className="flex items-center text-gray-700 cursor-pointer mt-4 mb-2">
                                                                <input
                                                                    type="checkbox"
                                                                    checked={locationDetail.askForPhoto}
                                                                    onChange={(e) => handleFilmingLocationSubQuestionChange(location, 'askForPhoto', e.target.checked)}
                                                                    className="form-checkbox h-4 w-4 text-blue-600 rounded"
                                                                />
                                                                <span className="ml-2">Ask for a photo of the space</span>
                                                            </label>
                                                            <label htmlFor={`${location}-photo-note`} className="block text-gray-600 text-xs font-semibold ml-6 mb-1">Add a note (optional)</label>
                                                            <textarea
                                                                id={`${location}-photo-note`}
                                                                value={locationDetail.photoNote}
                                                                onChange={(e) => handleFilmingLocationSubNoteChange(location, 'photoNote', e.target.value)}
                                                                className="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-400 ml-6 resize-y min-h-[50px] max-w-[600px]"
                                                                rows="2"
                                                                placeholder={`e.g., Please show the ${location.replace(/_/g, ' ')} you'll use. We need to confirm it fits the client's style.`}
                                                            ></textarea>
                                                        </div>
                                                    )}
                                                </React.Fragment>
                                            );
                                        })}
                                    </div>
                                    <label htmlFor="filming-location-note" className="block text-gray-600 text-xs font-semibold ml-8 mt-4 mb-1">Add a note (optional)</label>
                                    <textarea
                                        id="filming-location-note"
                                        value={getQuestionNote('filmingLocation')}
                                        onChange={(e) => handleNoteChange('filmingLocation', e.target.value)}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-400 ml-8 resize-y min-h-[70px] max-w-[600px]"
                                        rows="3"
                                        placeholder="e.g., We specifically need outdoor shots for this brief."
                                    ></textarea>
                                </div>

                                {/* New Co-stars Question */}
                                <br /><br />
                                <div className="border border-gray-200 rounded-md p-4 bg-gray-50">
                                    <label className="flex items-center text-gray-700 cursor-pointer mb-2">
                                        <input
                                            type="checkbox"
                                            value="coStars"
                                            checked={isQuestionSelected('coStars')}
                                            onChange={handleQuestionChange}
                                            className="form-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500"
                                        />
                                        <span className="ml-3 text-lg font-medium">Co-stars needed for this brief</span>
                                    </label>
                                    <p className="text-gray-500 text-sm ml-8 mb-3">
                                        Select which co-stars are relevant for this brief. We'll only ask the creator if they haven't already told us, or if you request confirmation.
                                    </p>
                                    <div className="ml-8 mt-4 flex flex-wrap gap-2">
                                        {allCoStars.map(coStar => {
                                            const coStarDetail = getCoStarDetails().find(d => d.name === coStar);
                                            const isCoStarSelected = !!coStarDetail;

                                            return (
                                                <React.Fragment key={coStar}>
                                                    <button
                                                        type="button"
                                                        onClick={() => handleCoStarChipChange(coStar)}
                                                        className={`px-4 py-2 rounded-full text-sm font-medium transition-colors duration-200
                                                            ${isCoStarSelected
                                                                ? 'bg-blue-600 text-white shadow-md'
                                                                : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                            }`}
                                                    >
                                                        {coStar.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}
                                                    </button>

                                                    {isCoStarSelected && (
                                                        <div className="w-full ml-8 mt-4 p-3 border border-gray-200 rounded-md bg-white shadow-sm">
                                                            <h4 className="text-md font-semibold text-gray-700 mb-3">{coStar.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())} Details:</h4>

                                                            {/* Ask to confirm availability */}
                                                            <label className="flex items-center text-gray-700 cursor-pointer mb-2">
                                                                <input
                                                                    type="checkbox"
                                                                    checked={coStarDetail.askConfirmAvailability}
                                                                    onChange={(e) => handleCoStarSubQuestionChange(coStar, 'askConfirmAvailability', e.target.checked)}
                                                                    className="form-checkbox h-4 w-4 text-blue-600 rounded"
                                                                />
                                                                <span className="ml-2">Ask to confirm availability</span>
                                                            </label>
                                                            {/* Removed the note field here */}
                                                            {/* Ask for a casting photo */}
                                                            <label className="flex items-center text-gray-700 cursor-pointer mt-4 mb-2">
                                                                <input
                                                                    type="checkbox"
                                                                    checked={coStarDetail.askForCastingPhoto}
                                                                    onChange={(e) => handleCoStarSubQuestionChange(coStar, 'askForCastingPhoto', e.target.checked)}
                                                                    className="form-checkbox h-4 w-4 text-blue-600 rounded"
                                                                />
                                                                <span className="ml-2">Ask for a casting photo</span>
                                                            </label>
                                                            <label htmlFor={`${coStar}-photo-note`} className="block text-gray-600 text-xs font-semibold ml-6 mb-1">Add a note (optional)</label>
                                                            <textarea
                                                                id={`${coStar}-photo-note`}
                                                                value={coStarDetail.castingPhotoNote}
                                                                onChange={(e) => handleCoStarSubNoteChange(coStar, 'castingPhotoNote', e.target.value)}
                                                                className="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-400 ml-6 resize-y min-h-[50px] max-w-[600px]"
                                                                rows="2"
                                                                placeholder={`e.g., We're looking for a small-breed ${coStar.replace(/_/g, ' ')} look. Please share a recent image.`}
                                                            ></textarea>
                                                        </div>
                                                    )}
                                                </React.Fragment>
                                            );
                                        })}
                                    </div>
                                    <label htmlFor="co-stars-note" className="block text-gray-600 text-xs font-semibold ml-8 mt-4 mb-1">Add a note (optional)</label>
                                    <textarea
                                        id="co-stars-note"
                                        value={getQuestionNote('coStars')}
                                        onChange={(e) => handleNoteChange('coStars', e.target.value)}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-400 ml-8 resize-y min-h-[70px] max-w-[600px]"
                                        rows="3"
                                        placeholder="e.g., We need co-stars that are comfortable with loud noises."
                                    ></textarea>
                                </div>


                            </div>
                        </div>

                        <button
                            onClick={handleSaveSurvey}
                            className="w-full py-3 bg-green-600 text-white font-bold rounded-md hover:bg-green-700 transition duration-300 ease-in-out shadow-lg transform hover:scale-105"
                        >
                            Save Survey Configuration
                        </button>
                    </div>
                </div>
            );
        };

        // Frontstage Component
        const Frontstage = ({ setView }) => {
            const { users, surveyConfig } = React.useContext(AppContext);
            const [userName, setUserName] = React.useState('');
            const [currentUser, setCurrentUser] = React.useState(null);
            const [message, setMessage] = React.useState('');
            // State for Frontstage dynamic inputs
            const [portfolioDecision, setPortfolioDecision] = React.useState(''); // 'yes' or 'no'
            const [newPortfolioLink, setNewPortfolioLink] = React.useState('');
            const [replacePortfolio, setReplacePortfolio] = React.useState(false);
            const [locationDecision, setLocationDecision] = React.useState(''); // 'yes' or 'no'
            const [newLocation, setNewLocation] = React.useState('');
            const [replaceLocation, setReplaceLocation] = React.useState(false);
            const [addressDecision, setAddressDecision] = React.useState(''); // 'yes' or 'no'
            const [newAddress, setNewAddress] = React.useState('');
            const [replaceAddress, setReplaceAddress] = React.useState(false);
            const [filmingLocationDecision, setFilmingLocationDecision] = React.useState(''); // 'yes' or 'no'
            const [filmingLocationResponses, setFilmingLocationResponses] = React.useState({}); // Stores responses for each location: { 'house': { isSelected: true, confirmAccess: false, uploadPhoto: false } }
            const [coStarDecision, setCoStarDecision] = React.useState(''); // 'yes' or 'no'
            const [coStarResponses, setCoStarResponses] = React.useState({}); // Stores responses for each co-star: { 'dog': { isAvailable: 'yes', hasPhoto: false } }


            const handleFindUser = () => {
                const foundUser = users.find(user => user.name.toLowerCase() === userName.toLowerCase());
                if (foundUser) {
                    setCurrentUser(foundUser);
                    setMessage('');
                    setPortfolioDecision('');
                    setNewPortfolioLink('');
                    setReplacePortfolio(false);
                    setLocationDecision('');
                    setNewLocation('');
                    setReplaceLocation(false);
                    setAddressDecision('');
                    setNewAddress('');
                    setReplaceAddress(false);
                    setFilmingLocationDecision('');
                    setFilmingLocationResponses({});
                    setCoStarDecision('');
                    setCoStarResponses({});

                } else {
                    setCurrentUser(null);
                    setMessage('User not found. Please check the name and try again.');
                }
            };

            const renderField = (label, value) => {
                if (value === undefined || value === null || (Array.isArray(value) && value.length === 0)) {
                    return null;
                }
                return (
                    <div className="mb-2">
                        <span className="font-semibold text-gray-700">{label}:</span>
                        <span className="ml-2 text-gray-900">{Array.isArray(value) ? value.join(', ') : value}</span>
                    </div>
                );
            };

            const getQuestionConfig = (id) => surveyConfig.selectedQuestions.find(q => q.id === id);

            const handleFilmingLocationUserResponse = (locationName, field, value) => {
                setFilmingLocationResponses(prev => ({
                    ...prev,
                    [locationName]: {
                        ...prev[locationName],
                        [field]: value
                    }
                }));
            };

            const handleCoStarUserResponse = (coStarName, field, value) => {
                setCoStarResponses(prev => ({
                    ...prev,
                    [coStarName]: {
                        ...prev[coStarName],
                        [field]: value
                    }
                }));
            };


            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex justify-center py-10 px-4">
                    <div className="bg-white p-8 rounded-xl shadow-2xl w-full max-w-[800px] border-t-4 border-blue-500">
                        <div className="flex justify-between items-center mb-10">
                            <h1 className="text-4xl font-extrabold text-gray-900">Creator UX</h1>
                            <button
                                onClick={() => setView('backstage')}
                                className="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition duration-300 ease-in-out shadow-md"
                            >
                                View Internal/Community UX (Create Questions)
                            </button>
                        </div>

                        <br /><br /><br />

                        <div className="mb-8">
                            <label htmlFor="userName" className="block text-gray-800 text-lg font-bold mb-3">Enter Your Name to Begin:</label>
                            <div className="flex space-x-3">
                                <input
                                    type="text"
                                    id="userName"
                                    value={userName}
                                    onChange={(e) => setUserName(e.target.value)}
                                    className="flex-grow px-5 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-3 focus:ring-blue-500 text-lg max-w-[600px]"
                                    placeholder="e.g., Alice 1"
                                />
                                <button
                                    onClick={handleFindUser}
                                    className="px-6 py-3 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition duration-300 ease-in-out shadow-lg transform hover:scale-105"
                                >
                                    Find My Profile
                                </button>
                            </div>
                            {message && <p className="mt-4 text-center text-sm font-medium text-red-600">{message}</p>}
                        </div>

                        {currentUser && (
                            <div className="bg-gray-50 p-6 rounded-lg border border-gray-200 shadow-inner">
                                <h2 className="text-2xl font-bold text-gray-800 mb-4">
                                    Hello {currentUser.name}!
                                    {surveyConfig.projectTitle && ` So pleased to see you're interested in ${surveyConfig.projectTitle}.`}
                                </h2>

                                {surveyConfig.briefSummary && (
                                    <div className="mb-6 p-4 bg-gray-100 rounded-md border border-gray-200">
                                        <h3 className="text-lg font-semibold text-gray-800 mb-2">Brief requirement summary</h3>
                                        <p className="text-gray-700 whitespace-pre-wrap">{surveyConfig.briefSummary}</p>
                                    </div>
                                )}

                                <p className="text-base font-normal text-gray-700 mb-6">Before we can proceed, please answer the following questions.</p>


                                {surveyConfig.selectedQuestions.length > 0 ? (
                                    surveyConfig.selectedQuestions.map(q => (
                                        <div key={q.id} className="mb-8 px-6 py-5 border border-gray-200 rounded-md bg-white shadow-sm">
                                            <h3 className="text-xl font-semibold text-gray-800 mb-4">{q.id === 'portfolio' ? 'Portfolio' : q.id === 'primaryWorkLocation' ? 'Primary work location' : q.id === 'address' ? 'Address' : q.id === 'filmingLocation' ? 'The filming location' : q.id === 'coStars' ? 'Your co-stars' : ''}</h3>

                                            {q.id === 'portfolio' && (
                                                <>
                                                    {q.note && (
                                                        <p className="text-gray-500 text-sm italic mb-1">
                                                            "{q.note}"
                                                        </p>
                                                    )}
                                                    <p className="text-gray-700 mb-2">We have your portfolio down as <span className="font-medium text-blue-700 break-all">{currentUser.portfolio}</span></p>
                                                    <p className="text-gray-700 mb-4">Is this still the right portfolio for this brief?</p>

                                                    <div className="flex items-center space-x-6 mb-4">
                                                        <label className="flex items-center text-gray-700">
                                                            <input
                                                                type="radio"
                                                                name="portfolioDecision"
                                                                value="yes"
                                                                checked={portfolioDecision === 'yes'}
                                                                onChange={() => { setPortfolioDecision('yes'); setNewPortfolioLink(''); setReplacePortfolio(false); }}
                                                                className="form-radio h-4 w-4 text-blue-600"
                                                            />
                                                            <span className="ml-2">Yes</span>
                                                        </label>
                                                        <label className="flex items-center text-gray-700">
                                                            <input
                                                                type="radio"
                                                                name="portfolioDecision"
                                                                value="no"
                                                                checked={portfolioDecision === 'no'}
                                                                onChange={() => setPortfolioDecision('no')}
                                                                className="form-radio h-4 w-4 text-blue-600"
                                                            />
                                                            <span className="ml-2">No</span>
                                                        </label>
                                                    </div>

                                                    {portfolioDecision === 'no' && (
                                                        <div className="mt-4">
                                                            <input
                                                                type="text"
                                                                value={newPortfolioLink}
                                                                onChange={(e) => setNewPortfolioLink(e.target.value)}
                                                                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-400 max-w-[600px]"
                                                                placeholder="Enter portfolio link"
                                                            />
                                                            <label className="flex items-center text-gray-700 mt-3">
                                                                <input
                                                                    type="checkbox"
                                                                    checked={replacePortfolio}
                                                                    onChange={(e) => setReplacePortfolio(e.target.checked)}
                                                                    className="form-checkbox h-4 w-4 text-blue-600 rounded"
                                                                />
                                                                <span className="ml-2">Replace what's on my profile</span>
                                                            </label>
                                                        </div>
                                                    )}
                                                </>
                                            )}

                                            {q.id === 'primaryWorkLocation' && (
                                                <>
                                                    {q.note && (
                                                        <p className="text-gray-500 text-sm italic mb-1">
                                                            "{q.note}"
                                                        </p>
                                                    )}
                                                    <p className="text-gray-700 mb-2">We have your location down as <span className="font-medium text-blue-700">{currentUser.primary_work_location[0]} in {currentUser.primary_work_location[1]}</span></p>
                                                    <p className="text-gray-700 mb-4">Is this current?</p>
                                                    <div className="flex items-center space-x-6 mb-4">
                                                        <label className="flex items-center text-gray-700">
                                                            <input
                                                                type="radio"
                                                                name="locationDecision"
                                                                value="yes"
                                                                checked={locationDecision === 'yes'}
                                                                onChange={() => { setLocationDecision('yes'); setNewLocation(''); setReplaceLocation(false); }}
                                                                className="form-radio h-4 w-4 text-blue-600"
                                                            />
                                                            <span className="ml-2">Yes</span>
                                                        </label>
                                                        <label className="flex items-center text-gray-700">
                                                            <input
                                                                type="radio"
                                                                name="locationDecision"
                                                                value="no"
                                                                checked={locationDecision === 'no'}
                                                                onChange={() => setLocationDecision('no')}
                                                                className="form-radio h-4 w-4 text-blue-600"
                                                            />
                                                            <span className="ml-2">No</span>
                                                        </label>
                                                    </div>

                                                    {locationDecision === 'no' && (
                                                        <div className="mt-4">
                                                            <input
                                                                type="text"
                                                                value={newLocation}
                                                                onChange={(e) => setNewLocation(e.target.value)}
                                                                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-400 max-w-[600px]"
                                                                placeholder="Enter your work location for this brief"
                                                            />
                                                            <label className="flex items-center text-gray-700 mt-3">
                                                                <input
                                                                    type="checkbox"
                                                                    checked={replaceLocation}
                                                                    onChange={(e) => setReplaceLocation(e.target.checked)}
                                                                    className="form-checkbox h-4 w-4 text-blue-600 rounded"
                                                                />
                                                                <span className="ml-2">Replace what's on my profile</span>
                                                            </label>
                                                        </div>
                                                    )}
                                                </>
                                            )}

                                            {q.id === 'address' && (
                                                <>
                                                    {q.note && (
                                                        <p className="text-gray-500 text-sm italic mb-1">
                                                            "{q.note}"
                                                        </p>
                                                    )}
                                                    {currentUser.Address ? ( // If address exists
                                                        <>
                                                            <p className="text-gray-700 mb-2">We have your address down as <span className="font-medium text-blue-700">{currentUser.Address}</span></p>
                                                            <p className="text-gray-700 mb-4">Is this correct/up to date?</p>
                                                            <div className="flex items-center space-x-6 mb-4">
                                                                <label className="flex items-center text-gray-700">
                                                                    <input
                                                                        type="radio"
                                                                        name="addressDecision"
                                                                        value="yes"
                                                                        checked={addressDecision === 'yes'}
                                                                        onChange={() => { setAddressDecision('yes'); setNewAddress(''); setReplaceAddress(false); }}
                                                                        className="form-radio h-4 w-4 text-blue-600"
                                                                    />
                                                                    <span className="ml-2">Yes</span>
                                                                </label>
                                                                <label className="flex items-center text-gray-700">
                                                                    <input
                                                                        type="radio"
                                                                        name="addressDecision"
                                                                        value="no"
                                                                        checked={addressDecision === 'no'}
                                                                        onChange={() => setAddressDecision('no')}
                                                                        className="form-radio h-4 w-4 text-blue-600"
                                                                    />
                                                                    <span className="ml-2">No</span>
                                                                </label>
                                                            </div>

                                                            {addressDecision === 'no' && (
                                                                <div className="mt-4">
                                                                    <input
                                                                        type="text"
                                                                        value={newAddress}
                                                                        onChange={(e) => setNewAddress(e.target.value)}
                                                                        className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-400 max-w-[600px]"
                                                                        placeholder="Enter new address"
                                                                    />
                                                                    <label className="flex items-center text-gray-700 mt-3">
                                                                        <input
                                                                            type="checkbox"
                                                                            checked={replaceAddress}
                                                                            onChange={(e) => setReplaceAddress(e.target.checked)}
                                                                            className="form-checkbox h-4 w-4 text-blue-600 rounded"
                                                                        />
                                                                        <span className="ml-2">Replace what's on my profile</span>
                                                                    </label>
                                                                </div>
                                                            )}
                                                        </>
                                                    ) : ( // If address does NOT exist
                                                        <>
                                                            <p className="text-gray-700 mb-2">Please provide your address:</p>
                                                            <input
                                                                type="text"
                                                                value={newAddress}
                                                                onChange={(e) => setNewAddress(e.target.value)}
                                                                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-400 max-w-[600px] mt-2"
                                                                placeholder="Enter your address"
                                                            />
                                                            <label className="flex items-center text-gray-700 mt-3">
                                                                <input
                                                                    type="checkbox"
                                                                    checked={replaceAddress} // Reusing 'replaceAddress' state for 'upload to profile'
                                                                    onChange={(e) => setReplaceAddress(e.target.checked)}
                                                                    className="form-checkbox h-4 w-4 text-blue-600 rounded"
                                                                />
                                                                <span className="ml-2">Upload to my profile</span>
                                                            </label>
                                                        </>
                                                    )}
                                                </>
                                            )}

                                            {q.id === 'filmingLocation' && (
                                                <>
                                                    {/* Required chips reminder */}
                                                    {q.details && q.details.length > 0 && (
                                                        <p className="text-gray-700 mb-2">
                                                            This brief requires a <span className="font-bold">{q.details.map(d => d.name.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())).join(' and ')}</span> setup
                                                        </p>
                                                    )}
                                                    {/* User's listed locations */}
                                                    <p className="text-gray-700 mb-4">On your profile, you have listed having access to <span className="font-bold">{currentUser.filming_location.join(', ').replace(/_/g, ' ')}</span></p>

                                                    <p className="text-gray-700 mb-4">Please confirm you have access to the following spaces:</p>

                                                    {/* Individual confirmation modules for each selected location from Backstage */}
                                                    {q.details.map(locationDetail => (
                                                        <div key={locationDetail.name} className="mt-6">
                                                            <h4 className="text-lg font-semibold text-gray-800 mb-3 flex items-center">
                                                                {/* Non-interactive bullet/checkmark */}
                                                                <svg className="w-5 h-5 text-blue-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                                                    <path fillRule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clipRule="evenodd"></path>
                                                                </svg>
                                                                {locationDetail.name.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}
                                                            </h4>

                                                            {/* Removed the note field here */}
                                                            <div className="flex items-center space-x-6 mb-4 ml-8">
                                                                <label className="flex items-center text-gray-700">
                                                                    <input
                                                                        type="radio"
                                                                        name={`${locationDetail.name}-accessDecision`}
                                                                        value="yes"
                                                                        checked={filmingLocationResponses[locationDetail.name]?.accessDecision === 'yes'}
                                                                        onChange={() => handleFilmingLocationUserResponse(locationDetail.name, 'accessDecision', 'yes')}
                                                                        className="form-radio h-4 w-4 text-blue-600"
                                                                    />
                                                                    <span className="ml-2">Yes, still accessible</span>
                                                                </label>
                                                                <label className="flex items-center text-gray-700">
                                                                    <input
                                                                        type="radio"
                                                                        name={`${locationDetail.name}-accessDecision`}
                                                                        value="no"
                                                                        checked={filmingLocationResponses[locationDetail.name]?.accessDecision === 'no'}
                                                                        onChange={() => handleFilmingLocationUserResponse(locationDetail.name, 'accessDecision', 'no')}
                                                                        className="form-radio h-4 w-4 text-blue-600"
                                                                    />
                                                                    <span className="ml-2">No, not currently accessible</span>
                                                                </label>
                                                            </div>

                                                            {locationDetail.askForPhoto && (
                                                                <div className="mt-4">
                                                                    <p className="text-lg font-semibold text-gray-800 mb-2">Please upload a photo of your space</p>
                                                                    {locationDetail.photoNote && (
                                                                        <p className="text-black text-sm italic font-bold mb-3">
                                                                            "{locationDetail.photoNote}"
                                                                        </p>
                                                                    )}
                                                                    <button className="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition duration-300 ease-in-out shadow-sm">
                                                                        Upload photo
                                                                    </button>
                                                                </div>
                                                            )}
                                                        </div>
                                                    ))}

                                                </>
                                            )}

                                            {q.id === 'coStars' && (
                                                <>
                                                    {/* Required co-stars reminder */}
                                                    {q.details && q.details.length > 0 && (
                                                        <p className="text-gray-700 mb-2">
                                                            This brief requires a <span className="font-bold">{q.details.map(d => d.name.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())).join(' and ')}</span> setup
                                                        </p>
                                                    )}
                                                    {/* User's listed co-stars */}
                                                    <p className="text-gray-700 mb-4">On your profile, you have listed having access to <span className="font-bold">{currentUser.co_stars.join(', ').replace(/_/g, ' ')}</span></p>

                                                    <p className="text-gray-700 mb-4">Please confirm you have access to the following co-stars:</p>

                                                    {/* Individual confirmation modules for each selected co-star from Backstage */}
                                                    {q.details.map(coStarDetail => (
                                                        <div key={coStarDetail.name} className="mt-6">
                                                            <h4 className="text-lg font-semibold text-gray-800 mb-3 flex items-center">
                                                                {/* Non-interactive bullet/checkmark */}
                                                                <svg className="w-5 h-5 text-blue-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                                                    <path fillRule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clipRule="evenodd"></path>
                                                                </svg>
                                                                {coStarDetail.name.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}
                                                            </h4>

                                                            {coStarDetail.askConfirmAvailability && (
                                                                <>
                                                                    {/* Removed the note field here */}
                                                                    <p className="text-gray-700 mb-4 ml-8">Do you have this co-star available for this shoot?</p>
                                                                    <div className="flex items-center space-x-6 mb-4 ml-8">
                                                                        <label className="flex items-center text-gray-700">
                                                                            <input
                                                                                type="radio"
                                                                                name={`${coStarDetail.name}-availabilityDecision`}
                                                                                value="yes"
                                                                                checked={coStarResponses[coStarDetail.name]?.availabilityDecision === 'yes'}
                                                                                onChange={() => handleCoStarUserResponse(coStarDetail.name, 'availabilityDecision', 'yes')}
                                                                                className="form-radio h-4 w-4 text-blue-600"
                                                                            />
                                                                            <span className="ml-2">Yes, they're available</span>
                                                                        </label>
                                                                        <label className="flex items-center text-gray-700">
                                                                            <input
                                                                                type="radio"
                                                                                name={`${coStarDetail.name}-availabilityDecision`}
                                                                                value="no"
                                                                                checked={coStarResponses[coStarDetail.name]?.availabilityDecision === 'no'}
                                                                                onChange={() => handleCoStarUserResponse(coStarDetail.name, 'availabilityDecision', 'no')}
                                                                                className="form-radio h-4 w-4 text-blue-600"
                                                                            />
                                                                            <span className="ml-2">No, not currently available</span>
                                                                        </label>
                                                                    </div>
                                                                </>
                                                            )}

                                                            {coStarDetail.askForCastingPhoto && (
                                                                <div className="mt-4">
                                                                    <p className="text-lg font-semibold text-gray-800 mb-2">Please share a recent photo of your co-star</p>
                                                                    {coStarDetail.castingPhotoNote && (
                                                                        <p className="text-black text-sm italic font-bold mb-3">
                                                                            "{coStarDetail.castingPhotoNote}"
                                                                        </p>
                                                                    )}
                                                                    <button className="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition duration-300 ease-in-out shadow-sm">
                                                                        Upload photo
                                                                    </button>
                                                                </div>
                                                            )}
                                                        </div>
                                                    ))}
                                                </>
                                            )}
                                        </div>
                                    ))
                                ) : (
                                    <p className="text-center text-lg text-gray-600 mt-8">No questions have been selected for this survey yet. Please check the Internal/Community UX.</p>
                                )}

                            </div>
                        )}
                    </div>
                </div>
            );
        };


        // Main App Component
        const App = () => {
            const [view, setView] = React.useState('backstage'); // 'backstage' or 'frontstage'
            const [users, setUsers] = React.useState([]);
            const [surveyConfig, setSurveyConfig] = React.useState({
                projectTitle: '',
                projectCode: '',
                briefSummary: '', // Initialize new state for brief summary
                selectedQuestions: [], // Now stores objects { id: string, note: string, details: any }
            });

            // Generate users on initial load
            React.useEffect(() => {
                setUsers(generateFictionalUsers());
            }, []);

            return (
                <AppContext.Provider value={{ users, surveyConfig, setSurveyConfig }}>
                    {view === 'backstage' ? (
                        <Backstage setView={setView} />
                    ) : (
                        <Frontstage setView={setView} />
                    )}
                </AppContext.Provider>
            );
        };

        // Render the React application
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
